<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GoTrust Pay – Version Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
 --primary:#0b3c5d;
 --accent:#1abc9c;
 --bg:#f4f6f8;
 --danger:#e74c3c;
}
body{margin:0;font-family:Arial;background:var(--bg)}
header{background:var(--primary);color:#fff;padding:15px;text-align:center}
section{padding:15px}
.card{background:#fff;border-radius:10px;padding:15px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
button{background:var(--accent);border:none;padding:10px 15px;border-radius:6px;font-weight:bold;cursor:pointer}
button.danger{background:var(--danger);color:#fff}
input,select{width:100%;padding:8px;margin:5px 0}
.hidden{display:none}
.badge{padding:4px 8px;border-radius:5px;font-size:12px;color:#fff}
.active{background:var(--accent)}
.inactive{background:#999}
nav button{margin:3px}
.small{font-size:12px;color:#555}
hr{border:none;border-top:1px solid #ddd}
</style>
</head>

<body>

<header>
<h2>GoTrust Pay</h2>
<p>Plateforme financière – Version Pro GitHub Pages</p>
</header>

<section id="home" class="card">
<button onclick="showAuth()">Connexion / Inscription</button>
</section>

<section id="auth" class="card hidden">
<select id="role">
<option value="client">Client</option>
<option value="agent">Agent GoPay</option>
<option value="admin">Administrateur</option>
</select>
<input id="name" placeholder="Nom" />
<input id="pin" type="password" placeholder="PIN (4 à 6 chiffres)" />
<button onclick="login()">Entrer</button>
<p class="small">Compte inactif sans activité</p>
</section>

<section id="client" class="hidden">
<nav>
<button onclick="view('dash')">Dashboard</button>
<button onclick="view('deposit')">Dépôt</button>
<button onclick="view('send')">Envoi</button>
<button onclick="view('withdraw')">Retrait</button>
<button onclick="logout()" class="danger">Déconnexion</button>
</nav>

<div id="dash" class="card"></div>

<div id="deposit" class="card hidden">
<input id="depAmt" type="number" placeholder="Montant dépôt">
<button onclick="deposit()">Confirmer</button>
</div>

<div id="send" class="card hidden">
<input id="sendID" placeholder="ID destinataire">
<input id="sendAmt" type="number" placeholder="Montant">
<button onclick="send()">Envoyer</button>
</div>

<div id="withdraw" class="card hidden">
<input id="withAmt" type="number" placeholder="Montant retrait">
<button onclick="requestWithdraw()">Demander</button>
</div>
</section>

<section id="admin" class="hidden">
<div class="card">
<h3>Administration – GOPAY</h3>
<p>Solde plateforme : <b id="adminBal"></b> FC</p>
</div>

<div class="card">
<h4>Utilisateurs</h4>
<div id="userList"></div>
</div>

<div class="card">
<h4>Demandes de retrait</h4>
<div id="withdrawList"></div>
</div>

<button onclick="logout()" class="danger">Déconnexion</button>
</section>

<script>
if(!localStorage.users) localStorage.users="[]";
if(!localStorage.withdraws) localStorage.withdraws="[]";
if(!localStorage.adminBal) localStorage.adminBal=1000000;

let current=null;
const users=()=>JSON.parse(localStorage.users);
const saveUsers=u=>localStorage.users=JSON.stringify(u);
const wid=()=>Math.floor(Math.random()*1e8).toString();

function showAuth(){
 home.classList.add("hidden");
 auth.classList.remove("hidden");
}

function login(){
 const r=role.value;
 const n=name.value.trim();
 const p=pin.value.trim();

 // Validation PIN
 if(r!=="admin" && !/^\d{4,6}$/.test(p)){
   alert("PIN invalide : 4 à 6 chiffres uniquement");
   return;
 }

 if(r==="admin"){
   if(n==="GOPAY" && p==="admin243"){
     auth.classList.add("hidden");
     admin.classList.remove("hidden");
     loadAdmin();
     return;
   }else{
     alert("Accès administrateur refusé");
     return;
   }
 }

 let u=users();
 let found=u.find(x=>x.name===n && x.pin===p && x.role===r);
 if(found){
   current=found;
 }else{
   current={id:wid(),role:r,name:n,pin:p,balance:0,active:false,history:[]};
   u.push(current);
   saveUsers(u);
 }

 auth.classList.add("hidden");
 client.classList.remove("hidden");
 renderDash();
}

function renderDash(){
 dash.innerHTML=`
 <h3>${current.name}</h3>
 <p>ID : ${current.id}</p>
 <p>Solde : <b>${current.balance} FC</b></p>
 <span class="badge ${current.active?'active':'inactive'}">
 ${current.active?'ACTIF':'INACTIF'}
 </span>
 <hr>
 <h4>Historique</h4>
 ${current.history.length ? current.history.join("<br>") : "Aucune activité"}
 `;
}

function view(v){
 ["dash","deposit","send","withdraw"].forEach(x=>document.getElementById(x).classList.add("hidden"));
 document.getElementById(v).classList.remove("hidden");
}

function deposit(){
 let a=+depAmt.value;
 if(a<=0)return;
 current.balance+=a;
 current.active=true;
 localStorage.adminBal-=a;
 current.history.push("Dépôt +"+a);
 save();renderDash();
}

function send(){
 if(!current.active)return alert("Compte inactif");
 let u=users().find(x=>x.id===sendID.value);
 if(!u)return alert("Introuvable");
 let a=+sendAmt.value;
 current.balance-=a;
 u.balance+=a;
 current.history.push("Envoi -"+a);
 u.history.push("Reçu +"+a);
 save(u);renderDash();
}

function requestWithdraw(){
 let a=+withAmt.value;
 let w=JSON.parse(localStorage.withdraws);
 w.push({id:current.id,amount:a});
 localStorage.withdraws=JSON.stringify(w);
 current.history.push("Retrait demandé "+a);
 save();renderDash();
}

// ADMIN
function loadAdmin(){
 adminBal.innerText=localStorage.adminBal;

 // Liste utilisateurs
 userList.innerHTML=users().map(u=>`${u.name} (${u.role}) – ${u.balance} FC`).join("<br>");

 // Liste demandes retrait avec bouton valider
 let wList=JSON.parse(localStorage.withdraws);
 withdrawList.innerHTML=wList.map((w,i)=>{
   return `<div>${w.id} : ${w.amount} FC 
     <button onclick="approve(${i})">Valider</button></div>`;
 }).join("");
}

// Valider retrait
function approve(i){
 let wList=JSON.parse(localStorage.withdraws);
 let w=wList[i];
 let u=users().find(x=>x.id===w.id);
 if(!u)return;

 let com=0; // pas de commission pour simplification
 u.balance-=w.amount+com;
 localStorage.adminBal=+localStorage.adminBal + w.amount;
 wList.splice(i,1);
 localStorage.withdraws=JSON.stringify(wList);
 save(u); loadAdmin();
 alert("Retrait confirmé : "+w.amount+" FC");
}

function save(extra){
 let u=users();
 let idx=u.findIndex(x=>x.id===current.id);
 u[idx]=current;
 if(extra) u[u.findIndex(x=>x.id===extra.id)]=extra;
 saveUsers(u);
}

function logout(){location.reload()}
</script>

</body>
</html>
