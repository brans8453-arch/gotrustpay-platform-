<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GoTrust Pay – VERSION PRÉ-RÉEL AVANCÉE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#0b3c5d;color:#fff;padding:15px;text-align:center}
section{padding:15px}
.card{background:#fff;border-radius:10px;padding:15px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
input,select,button{width:100%;padding:10px;margin:5px 0}
button{background:#1abc9c;border:none;color:#fff;font-weight:bold;border-radius:6px;cursor:pointer}
.hidden{display:none}
nav button{margin:3px;cursor:pointer}
.badge{padding:4px 8px;border-radius:5px;color:#fff;font-size:12px}
.active{background:#1abc9c}
</style>
</head>
<body>
<header>
<h2>GoTrust Pay</h2>
<p>Plateforme financière – VERSION PRÉ-RÉEL AVANCÉE</p>
</header>

<!-- LOGIN / CREATION -->
<section id="login" class="card">
<h3>Connexion / Création de compte</h3>
<select id="role">
<option value="client">Client</option>
<option value="agent">Agent</option>
<option value="admin">Administrateur</option>
</select>
<input id="username" placeholder="Nom ou Identifiant">
<input id="password" type="password" placeholder="Mot de passe (6 chiffres)">
<button onclick="login()">Entrer</button>
<button onclick="createAccount()">Créer un compte</button>
<p style="font-size:12px">Connexion libre pour clients/agents – Admin: GOPAY/admin243</p>
</section>

<!-- CLIENT / AGENT DASHBOARD -->
<section id="client" class="hidden">
<nav>
<button onclick="show('dash')">Dashboard</button>
<button onclick="show('deposit')">Dépôt</button>
<button onclick="show('send')">Envoi</button>
<button onclick="show('withdraw')">Retrait</button>
<button onclick="logout()">Déconnexion</button>
</nav>

<div id="dash" class="card"></div>

<div id="deposit" class="card hidden">
<h4>Dépôt</h4>
<input id="depAmount" type="number" placeholder="Montant">
<select id="depService"><option>Orange</option><option>Airtel</option><option>Vodacom</option><option>GoPay</option></select>
<button onclick="deposit()">Confirmer</button>
</div>

<div id="send" class="card hidden">
<h4>Envoi</h4>
<input id="sendTo" placeholder="ID ou Nom du destinataire">
<input id="sendAmount" type="number" placeholder="Montant">
<button onclick="send()">Envoyer</button>
</div>

<div id="withdraw" class="card hidden">
<h4>Retrait</h4>
<input id="withAmount" type="number" placeholder="Montant">
<input id="withCode" type="password" placeholder="Code retrait (6 chiffres)">
<select><option>Orange</option><option>Airtel</option><option>Vodacom</option><option>GoPay</option></select>
<button onclick="withdraw()">Confirmer</button>
</div>
</section>

<!-- ADMIN DASHBOARD -->
<section id="admin" class="hidden">
<div class="card"><h3>Administration</h3><p id="adminInfo"></p></div>
<div class="card"><h4>Activités récentes</h4><div id="activity"></div></div>
<button onclick="logout()">Déconnexion</button>
</section>

<script>
let current=null;

// INITIALISATION DES COMPTES EXISTANTS
let users=JSON.parse(localStorage.getItem('users')||'{}');

// LOGIN FUNCTION
function login(){
  const r=document.getElementById('role').value;
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value.trim();

  if(r==='admin'){
    if(u==='GOPAY' && p==='admin243'){
      document.getElementById('login').style.display='none';
      document.getElementById('admin').classList.remove('hidden');
      document.getElementById('adminInfo').innerText="Connecté en tant qu'administrateur";
      return;
    } else {
      return alert('Accès admin refusé');
    }
  }

  // LOGIN CLIENT / AGENT
  if(users[u] && users[u].password===p){
    current={...users[u]};
    document.getElementById('login').style.display='none';
    document.getElementById('client').classList.remove('hidden');
    renderDash();
  } else {
    alert("Utilisateur inconnu ou mot de passe incorrect");
  }
}

// CREATION DE COMPTE CLIENT / AGENT
function createAccount(){
  const r=document.getElementById('role').value;
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value.trim();

  if(r==='admin') return alert("Impossible de créer un compte admin ici");
  if(!/^\d{6}$/.test(p)) return alert("Mot de passe invalide (6 chiffres requis)");
  if(!u) return alert("Nom ou identifiant requis");
  if(users[u]) return alert("Nom déjà utilisé");

  users[u]={name:u,role:r,id:Math.floor(Math.random()*1e8),balance:0,password:p,activities:[]};
  localStorage.setItem('users',JSON.stringify(users));
  alert("Compte créé avec succès ! Vous pouvez maintenant vous connecter");
}

// DASHBOARD
function renderDash(){
  const dash=document.getElementById('dash');
  dash.innerHTML=`<h3>Bienvenue ${current.name} (${current.role})</h3>
  <p>ID : ${current.id}</p>
  <p>Solde : <b>${current.balance} FC</b></p>`;
  updateActivity();
}

// SHOW SECTIONS
function show(section){
  ['dash','deposit','send','withdraw'].forEach(s=>document.getElementById(s).classList.add('hidden'));
  document.getElementById(section).classList.remove('hidden');
}

// DEPOSIT
function deposit(){
  const a=+document.getElementById('depAmount').value;
  if(a>0){
    current.balance+=a;
    log(`Dépôt +${a} via ${document.getElementById('depService').value}`);
    renderDash();
    saveUser();
  } else alert("Montant invalide");
}

// SEND
function send(){
  const a=+document.getElementById('sendAmount').value;
  const dest=document.getElementById('sendTo').value.trim();
  if(!dest) return alert("Destinataire requis");
  if(!users[dest]) return alert("Destinataire inexistant");
  if(a>0 && a<=current.balance){
    current.balance-=a;
    users[dest].balance+=a;
    log(`Envoi -${a} vers ${dest}`);
    users[dest].activities.push(`${new Date().toLocaleString()} : Reçu +${a} de ${current.name}`);
    renderDash();
    saveUser();
  } else alert("Montant invalide ou solde insuffisant");
}

// WITHDRAW
function withdraw(){
  const a=+document.getElementById('withAmount').value;
  const code=document.getElementById('withCode').value;
  if(a>0 && /^\d{6}$/.test(code)){
    if(a<=current.balance){
      current.balance-=a;
      log(`Retrait -${a} via ${document.querySelector('#withdraw select').value}`);
      renderDash();
      saveUser();
    } else alert("Solde insuffisant");
  } else alert("Montant ou code retrait invalide");
}

// LOG ACTIVITIES
function log(text){
  const now=new Date().toLocaleString();
  current.activities=current.activities||[];
  current.activities.push(`${now} : ${text}`);
  updateActivity();
}

// UPDATE ACTIVITIES
function updateActivity(){
  document.getElementById('activity').innerHTML=(current.activities||[]).join('<br>');
}

// SAVE USER DATA
function saveUser(){
  users[current.name]=current;
  localStorage.setItem('users',JSON.stringify(users));
}

// LOGOUT
function logout(){
  location.reload();
}
</script>
</body>
</html>
